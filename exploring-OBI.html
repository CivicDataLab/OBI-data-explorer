<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="CivicDataLab" />


<title>Exploring the Union Budget allocation for the Ministry of Environment, Forests and Climate Change for the year 2020-21</title>

<script src="exploring-OBI_files/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="exploring-OBI_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="exploring-OBI_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="exploring-OBI_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="exploring-OBI_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="exploring-OBI_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="exploring-OBI_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="exploring-OBI_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="exploring-OBI_files/navigation-1.1/tabsets.js"></script>
<link href="exploring-OBI_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="exploring-OBI_files/highlightjs-9.12.0/highlight.js"></script>
<script src="exploring-OBI_files/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="exploring-OBI_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="exploring-OBI_files/datatables-binding-0.11/datatables.js"></script>
<link href="exploring-OBI_files/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="exploring-OBI_files/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="exploring-OBI_files/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="exploring-OBI_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="exploring-OBI_files/crosstalk-1.0.0/js/crosstalk.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exploring the Union Budget allocation for the Ministry of Environment, Forests and Climate Change for the year 2020-21</h1>
<h4 class="author">CivicDataLab</h4>

</div>


<p><br />Last updated: 04 February, 2020 (See <a href="">changelog</a>).</p>
<p>The objective of this notebook is to demonstrate the exploration of the <a href="openbudgetsindia.org/">OpenBudgetsIndia</a> (OBI) platform right from our favourite programming environment.</p>
<p>We will use the <a href="https://github.com/ropensci/ckanr">ckanr</a> package developed by the amazing folks at <a href="https://ropensci.org/">ROpenSci</a>. This is used to read and update data from <a href="https://ckan.org/">CKAN</a> instanes. Since, OBI is yet another CkAN instance, this packages works perfectly to read and explore (and write as well) data from and to the <a href="openbudgetsindia.org/">Open Budgets India</a> platform.</p>
<p>Please check the <a href="https://github.com/ropensci/ckanr">ckanr Github repo</a> more nuanced documentation and examples</p>
<div id="step-1---connecting-to-obi" class="section level3">
<h3>Step 1 - Connecting to OBI</h3>
<pre class="r"><code>org_url &lt;- &quot;https://openbudgetsindia.org/&quot;
ckanr::ckanr_setup(url = org_url)
org_connect &lt;- ckanr::src_ckan(url = org_url)</code></pre>
<pre><code>## url: https://openbudgetsindia.org/</code></pre>
<pre class="r"><code>### Check connection
ckanr::ckan_version()</code></pre>
<pre><code>## $version
## [1] &quot;2.6.0a&quot;
## 
## $version_num
## [1] 26</code></pre>
</div>
<div id="step-2---exploring-an-organisation" class="section level3">
<h3>Step 2 - Exploring an organisation</h3>
<p>In this exercise, we would like to see the budget allocation for the year 2020-21 within the Ministry of Environment, Forest and Climate Change. Ministries are considered as organisation in OBI, let’s see if we can access the description of this organisation</p>
<pre class="r"><code>ministry_details &lt;- ckanr::organization_show(id = &quot;ministry-of-environment-forests-and-climate-change&quot;,include_datasets = TRUE)

### Explore Organisation details
# listviewer::jsonedit(ministry_details)
ministry_details$description[[1]] %&gt;% stringr::str_to_sentence() %&gt;% cat()</code></pre>
<pre><code>## This section records total budget allocation for schemes and programmes under ministry of environment, forests and climate change . It includes secretariat-economic services,state forest service and rangers college,indira gandhi national forest academy,training of i.f.s. officers,indian institute of forestry management,indian council of forestry research and education,indian plywood industries research institute,survey and utilisation of forest resources,forest conservation, development and regeneration,wildlife institute of india,project tiger,project elephant,central zoo authority,control of wildlife crime,integrated development of wildlife habitats,national afforestation and eco-development board:</code></pre>
</div>
<div id="step-3---exploring-datasets-present-within-an-organisation" class="section level3">
<h3>Step 3 - Exploring datasets present within an organisation</h3>
<p>Moving further, let’s check the kind of datasets present within this org.</p>
<pre class="r"><code>all_datasets &lt;- purrr::map(ministry_details$packages,&#39;title&#39;) %&gt;% unlist()
all_datasets</code></pre>
<pre><code>##  [1] &quot;Union Budget (2020-21) - Ministry of Environment, Forests and Climate Change&quot;   
##  [2] &quot;Union Budget (2019-20) - Ministry of Environment, Forests and Climate Change&quot;   
##  [3] &quot;Union Budget (2019-20)(I) - Ministry of Environment, Forests and Climate Change&quot;
##  [4] &quot;Union Budget (2018-19) - Ministry of Environment, Forests and Climate Change&quot;   
##  [5] &quot;Union Budget (2017-18) - Ministry of Environment, Forests and Climate Change&quot;   
##  [6] &quot;Union Budget (2015-16) - Ministry of Environment, Forests and Climate Change&quot;   
##  [7] &quot;Union Budget (2016-17) - Ministry of Environment, Forests and Climate Change&quot;   
##  [8] &quot;Union Budget (2014-15) - Ministry of Environment, Forests and Climate Change&quot;   
##  [9] &quot;Union Budget (2013-14) - Ministry of Environment, Forests and Climate Change&quot;   
## [10] &quot;Union Budget (2012-13) - Ministry of Environment, Forests and Climate Change&quot;   
## [11] &quot;Union Budget (2011-12) - Ministry of Environment, Forests and Climate Change&quot;</code></pre>
<p>This organsiation (or Ministry) has data from 2011/12 right till 2020/21. Since we’re interested in the budget allocation for 2020/21, let us now see how we can access the data within this dataset (or a <code>package</code>)</p>
</div>
<div id="step-4---viewing-a-package" class="section level3">
<h3>Step 4 - Viewing a package</h3>
<p>A package (or a dataset) contains several files within. For this analysis, we would like to get access to the tabular datasets or a <strong>CSV</strong> which has allocation details for several important budget heads.</p>
<pre class="r"><code># Get the package ID
data_2020_id &lt;- ministry_details$packages[[1]]$id
pacakage_details &lt;- package_show(data_2020_id)

# Explore package
# listviewer::jsonedit(pacakage_details)

# Get data formats
format_details &lt;- purrr::map_df(pacakage_details$resources,`[`,c(&#39;format&#39;,&#39;id&#39;))

print(format_details)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   format id                                  
##   &lt;chr&gt;  &lt;chr&gt;                               
## 1 CSV    7e19e4a5-0ad0-4686-b482-ed5d554ee1b6
## 2 XLSX   7e9b1fc2-d3ef-4d93-be3d-d6b1cd246fa2
## 3 PDF    20f8b0b4-6b7b-44e4-8102-a793eb4ce055</code></pre>
<p>Note: All three formats can be accessed in a similar way. We shall fetch the <code>ID</code> of a particular file (or a <code>resource</code>) which will then be used for reading contents.</p>
</div>
<div id="step-5---reading-data-from-a-file" class="section level3">
<h3>Step 5 - Reading data from a file</h3>
<p>Data can easily be exported as a data frame which is a suitable format for analysing this data.</p>
<p><code>ckanr implements a dplyr SQL interface to CKAN's datastore. You can access any resource in the datastore directly using only the CKAN resource ID. Note: this will only work for resources which were uploaded successfully to the datastore - they will show the green &quot;Data API&quot; button in CKAN.</code></p>
<pre class="r"><code># Get data from CSV
res_id &lt;- format_details$id[format_details$format == &#39;CSV&#39;]
# budget_data &lt;- dplyr::tbl(src = org_connect$con, from = res_id) %&gt;% as_tibble(.)

# data.table::fwrite(budget_data,file = &quot;data/ministry-of-environment-forests-and-climate-change-2020.csv&quot;)
budget_data &lt;- readr::read_csv(&quot;data/ministry-of-environment-forests-and-climate-change-2020.csv&quot;)

# Get column names
names(budget_data)</code></pre>
<pre><code>##  [1] &quot;Index&quot;                     &quot;Budget 2019-2020 Revenue&quot; 
##  [3] &quot;Budget 2020-2021 Total&quot;    &quot;Actual 2018-2019 Capital&quot; 
##  [5] &quot;Budget 2019-2020 Total&quot;    &quot;Budget 2020-2021 Revenue&quot; 
##  [7] &quot;Actual 2018-2019 Total&quot;    &quot;_full_text&quot;               
##  [9] &quot;Particulars&quot;               &quot;Revised 2019-2020 Total&quot;  
## [11] &quot;Actual 2018-2019 Revenue&quot;  &quot;Budget 2020-2021 Capital&quot; 
## [13] &quot;Revised 2019-2020 Revenue&quot; &quot;Budget 2019-2020 Capital&quot; 
## [15] &quot;_id&quot;                       &quot;Type&quot;                     
## [17] &quot;Revised 2019-2020 Capital&quot;</code></pre>
</div>
<div id="step-6---preparing-the-data-for-analysis" class="section level3">
<h3>Step 6 - Preparing the data for analysis</h3>
<p>For this analysis, we would like to see the change in allocation from the financial year 2018/19 to 2020/21. To prepare this dataset:</p>
<ul>
<li>Remove missing values
<ul>
<li>Remove rows with missing value for ‘Particulars’ col</li>
<li>Convert the budget cols to numeric</li>
<li>Convert NA to 0 in budget cols</li>
<li>Remove rows where the sum of all budget cols is 0</li>
</ul></li>
<li>Remove whitespaces from the ‘Particulars’ col</li>
<li>Remove the Grand Total Columns</li>
<li>Add the <code>Budget difference</code> column which is calulated as the difference of <code>Budget 2020-2021 Total</code> and <code>Actual 2018-2019 Total</code></li>
<li>Remove <code>EAP Component</code> as it is repeating multiple times in the Particulars col (Why is this happening ?)</li>
</ul>
<pre class="r"><code>cols_required &lt;- c(&#39;Particulars&#39;, &#39;Actual 2018-2019 Total&#39;, &#39;Revised 2019-2020 Total&#39; ,&#39;Budget 2020-2021 Total&#39;)
data_for_analysis &lt;- budget_data[,cols_required]

# Clean it a bit .. 
data_for_analysis &lt;- data_for_analysis[!is.na(data_for_analysis$Particulars),]
numeric_fields &lt;- c(&#39;Actual 2018-2019 Total&#39;,&#39;Revised 2019-2020 Total&#39;,&#39;Budget 2020-2021 Total&#39;)
data_for_analysis[,numeric_fields] &lt;- sapply(data_for_analysis[,numeric_fields], as.numeric)
data_for_analysis[is.na(data_for_analysis)] &lt;- 0 
data_for_analysis  &lt;- data_for_analysis[(data_for_analysis$`Actual 2018-2019 Total` + data_for_analysis$`Revised 2019-2020 Total` + data_for_analysis$`Budget 2020-2021 Total`) &gt; 0,]
data_for_analysis$Particulars &lt;- stringr::str_trim(data_for_analysis$Particulars)
data_for_analysis &lt;- data_for_analysis[!data_for_analysis$Particulars %in% c(&#39;Grand Total&#39;),]

# Add new column for the difference in budget from 2018-19 to 2021-21
data_for_analysis$`Budget Difference` &lt;- data_for_analysis$`Budget 2020-2021 Total` - data_for_analysis$`Actual 2018-2019 Total`

# Removing EAP Component
data_for_analysis &lt;- data_for_analysis[!data_for_analysis$Particulars %in% c(&#39;EAP Component&#39;),]</code></pre>
</div>
<div id="step-7---exploring-the-processed-data" class="section level3">
<h3>Step 7 - Exploring the processed data</h3>
<pre class="r"><code>DT::datatable(data.table::data.table(data_for_analysis), rownames = FALSE,
    options = list(
      searching=TRUE, 
      lengthChange=FALSE, 
      ordering=FALSE, 
      autoWidth=TRUE, 
      bPaginate=TRUE, 
      bInfo=TRUE, 
      paging=TRUE
    ))</code></pre>
<div id="htmlwidget-9fcce3c4870fcf74f36e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9fcce3c4870fcf74f36e">{"x":{"filter":"none","data":[["Secretariat","Regional Offices","National Afforestation and Eco-Development Board","National River Conservation Directorate","Forest Survey of India","Indira Gandhi National Forest Academy","State Forest Service and Rangers College","Wildlife Crime Control Bureau","National Institute of Animal Welfare","Botanical Survey of India","Zoological Survey of India","National Museum of Natural History","National Green Tribunal","Total- Attached/Subordinate Offices","Gross Budgetary Support","Gross Budgetary Support","Total-Establishment Expenditure of the Centre","Programme Component","Total- Forestry Training and Capacity Building","Eco-Task Force","Total-Environmental Knowledge and Capacity Building","Programme Component","Total- National Coastal Mission (NCM)","Pollution Abatement","Programme Component","Total- Hazardous Substances Management (HSM)","Climate Change Action Plan","National Adaptation Fund","National Mission on Himalayan Studies","Total-Environment Protection, Management and Sustainable Development","Environmental Education, Awareness and Training","Environment Information Systems (ENVIS)","Centres of Excellence","R and D for Conservation and Development","Total-Decision support System for Environmental Awareness, Policy, Planning and Outcome Evaluation","Control of Pollution","Total-Central Sector Schemes/Projects","Animal Welfare Board","Central Pollution Control Board","Central Zoo Authority","National Biodiversity Authority","National Tiger Conservation Authority","Total-Statutory and Regulatory Bodies","GB Pant Himalayan Institue of Environment and Development","Indian Council of Forestry Research and Education","Indian Institute of Forest Management","Indian Plywood Industries Research and Training Institute","Wildlife Institute of India","Total-Autonomous Bodies","Total-Other Central Sector Expenditure","Green India Mission-National Afforestation Programme","Green India Mission- National Afforestation Programme (EAP Component)","Forest Fire Prevention and Management","Total- National Mission for a Green India","Project Tiger","Project Elephant","Development of Wildlife Habitats","Development of Wildlife Habitats (EAP Component)","Total- Integrated Development of Wildlife Habitats","Biodiversity Conservation","Conservation of Aquatic Ecosystems","Conservation of Aquatic Ecosystems (EAP Component)","Total- Conservation of Natural Resources and Ecosystems","Programme Component","Total- National River Conservation Programme","Total-Environment, Forestry and Wildlife","Total-Centrally Sponsored Schemes","Forestry and Wild Life","Ecology and Environment","Secretariat-Economic Services","Capital Outlay on Forestry and Wild Life","Capital Outlay on Other Scientific and Environmental Research","Total-Economic Services","North Eastern Areas","Grants-in-aid to State Governments","Grants-in-aid to Union Territory Governments","Total-Others"],[131.8,34.31,8.5,7.79,33.15,53.26,20.26,10.73,3.99,75.17,71.28,29.5,36.21,384.15,27.85,0,537.88,8.18,28.52,112.85,141.37,9.55,129.55,19.72,12.96,12.96,33.17,109.78,50,225.63,69.45,23.84,14.06,1.56,108.91,4.95,610.41,9.78,114.42,12,19,9.87,165.07,27.5,220.99,34.99,10,33,326.48,459.17,175.82,1,46.58,223.4,323.44,29.75,164.59,10,527.78,13,63.6,0,76.6,143.5,150.33,978.11,978.11,662.25,803.25,131.8,15.1,30.57,1642.97,0,936.17,6.43,942.6],[137.25,35.28,7.74,0,34.65,58.19,21.75,11,0,85,79.64,22.5,36.4,392.15,27.8,50,547.82,10.8,10.8,75,85.8,16,96,10,4.25,4.25,15,40,47,116.25,72,28,11.5,4.5,116,445,859.05,0,100,8.5,20,9,137.5,25,230,32,10,30,327,464.5,179,11,47,237,282.57,31,175,5,493.57,9,45.4,1.6,56,0,0,786.57,786.57,666.88,1073.31,137.25,19.55,27,1923.99,165.5,567.95,0.5,733.95],[139,37,9,0,35.4,67.15,25,14,0,88,97,32.5,101,506.05,36,100,671.27,11.37,11.37,75,86.37,18,103,10,12,12,40,80,50,192,114.36,40,14,7.5,175.86,460,1017.23,0,100,12,23,10.5,145.5,28,230,37,11,34,340,485.5,246,15,50,311,300,35,148.41,48.59,532,13,68.4,1.6,83,0,0,926,926,599.19,1227.26,139,39.55,118,2123,180,795.5,1.5,977],[7.19999999999999,2.69,0.5,-7.79,2.25,13.89,4.74,3.27,-3.99,12.83,25.72,3,64.79,121.9,8.15,100,133.39,3.19,-17.15,-37.85,-55,8.45,-26.55,-9.72,-0.960000000000001,-0.960000000000001,6.83,-29.78,0,-33.63,44.91,16.16,-0.0600000000000005,5.94,66.95,455.05,406.82,-9.78,-14.42,0,4,0.630000000000001,-19.57,0.5,9.00999999999999,2.01,1,1,13.52,26.33,70.18,14,3.42,87.6,-23.44,5.25,-16.18,38.59,4.22000000000003,0,4.8,1.6,6.40000000000001,-143.5,-150.33,-52.11,-52.11,-63.0599999999999,424.01,7.19999999999999,24.45,87.43,480.03,180,-140.67,-4.93,34.4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Particulars<\/th>\n      <th>Actual 2018-2019 Total<\/th>\n      <th>Revised 2019-2020 Total<\/th>\n      <th>Budget 2020-2021 Total<\/th>\n      <th>Budget Difference<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":true,"lengthChange":false,"ordering":false,"autoWidth":true,"bPaginate":true,"bInfo":true,"paging":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="step-8---further-exploration" class="section level3">
<h3>Step 8 - Further exploration</h3>
<p>To check how the allocation has changed from 2018-19 to 2020-21:</p>
<ul>
<li>Look at the Top and Bottom <strong>20</strong> departments in terms of increase in the budget allocation in this specific period</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
